<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
            <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-89717266-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-89717266-1');
        </script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
        <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/styles/a11y-dark.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js"></script>
        <link href="/css/base.css" rel="stylesheet">

        <title>About this Site - The Terminal</title>
    <link href="/css/blog.css" rel="stylesheet"></head>
    <body>
        <div class="content">
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/blog">Blog</a></li>
                <li><a href="/feed.xml"><span class="small-caps">RSS</span></a></li>
            </ul> 
        </nav>
        
<article>
    <h1 class="title">About this Site - The Terminal</h1>
    <h3>I’m Back!</h3>
<p>I’ve been plan­ning on con­tin­u­ing my<span class="push-double"></span> <span class="pull-double">“</span>About this Site” se­ries for a while now
(like over 2 months), but I guess I’ve been dis­tracted with other things (as a
high schooler does). Regardless, partly due to the prompt­ing of a friend, here
is the third in­stall­ment.</p>
<h3>Table of Contents</h3>
<ul>
<li><a href="#inspiration">Inspiration</a></li>
<li><a href="#problems">Problems</a></li>
<li><a href="#specs">Specs</a></li>
<li><a href="#lets-get-down-to-business">Let’s Get Down to Business</a>
<ul>
<li><a href="#better-design">Better Design</a></li>
<li><a href="#procedural-generation">Procedural Generation</a></li>
<li><a href="#extensibility">Extensibility</a></li>
</ul>
</li>
<li><a href="#wrap-up">Wrap-up</a>
<ul>
<li><a href="#improvements">Improvements</a></li>
</ul>
</li>
</ul>
<h3>Inspiration</h3>
<p>I be­lieve I have waxed po­etic about the com­mand line be­fore. I most def­i­nitely
will in the fu­ture if I have not al­ready. I was, there­fore, kind of in­fat­u­ated
with the idea of a web­site that has a lit­tle com­mand line built into it. This
was im­ple­mented in my orig­i­nal web­site, where I even added scan lines and a
sub­tle flicker to re­ally drive home the retro feel.</p>
<figure class="figure">
    <img src="/assets/img/old_site_terminal.png">
    <figcaption class="img-caption">My old web­site</figcaption>
</figure>
<p>For this re­fresh, though, I wanted to make some­thing cleaner. More im­por­tantly,
I wanted to make some­thing that re­quired very lit­tle main­te­nance.</p>
<h3>Problems</h3>
<p>First, let’s go through some of the prob­lems with the pre­vi­ous Javascript
terminal. For one thing, there were er­rors that were straight up ig­nored (to be
fair, this er­ror did­n’t break any func­tion­al­ity).</p>
<figure class="figure">
    <img src="/assets/img/old_terminal_errors.png">
    <figcaption class="img-caption">Look at all those
er­rors</figcaption>
</figure>
<p>Also, just about every­thing, from the com­mands to the avail­able files, was
hard­coded. This meant if I were to add a new sec­tion to my site, I would have to
man­u­ally up­date that code. What a drag. It ended up with code that looked like
this:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">if</span> (parsed.cmd === <span class="hljs-string">'open'</span>) {
<span class="hljs-keyword">var</span> target = <span class="hljs-string">'#'</span> + parsed.arg;
$.smoothScroll({
<span class="hljs-attr">scrollTarget</span>: target
});
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (parsed.cmd === <span class="hljs-string">'ls'</span>) {
out = <span class="hljs-string">'about&#x26;nbsp;&#x26;nbsp;&#x26;nbsp;&#x26;nbsp;&#x26;nbsp;projects&#x26;nbsp;&#x26;nbsp;&#x26;nbsp;&#x26;nbsp;&#x26;nbsp;contact'</span>;
} <span class="hljs-keyword">else</span> {
out = <span class="hljs-string">'That command is not yet supported. Try ls or open.'</span>;
}
</code></pre>
<p>Ewwwww.</p>
<h3>Specs</h3>
<p>So for this new and im­proved ter­mi­nal, I wanted sev­eral fea­tures:</p>
<ol>
<li>Better de­sign (this meant a vis­i­ble, blink­ing cur­sor)</li>
<li>Procedurally gen­er­ated files (this proved to be the most chal­leng­ing)</li>
<li>Extensible com­mand sys­tem (I used <span class="small-caps">ES6</span> classes for this)</li>
</ol>
<h3>Let’s Get Down to Business</h3>
<p>We’re not go­ing to de­feat the Huns, but we <em>are</em> go­ing to make our new and
im­proved ter­mi­nal.</p>
<h4>Better Design</h4>
<p>Okay, so this one is kind of vague. I mocked up the <a href="/blog/2017-03-05-About-this-Site---Design/">de­sign</a>, which was heav­ily
in­spired by my ac­tual ter­mi­nal.</p>
<p>The most dif­fi­cult part was prob­a­bly hid­ing the cur­sor and re­plac­ing it with a
block cur­sor. I still don’t have a per­fect im­ple­men­ta­tion - in case you did­n’t
re­al­ize, you can’t ac­tu­ally move the cur­sor around on the line. It just stays at
the end of the line.</p>
<p>The thing about the cur­sor (or caret, if you’d like) is that it is al­ways the
same color as your text. There’s no way to style it in­di­vid­u­ally. The trick here
is to <strong>make the text trans­par­ent</strong>. Then, just add a text-shadow with your text
color and no off­set. This keeps every­thing the same ex­cept for the caret, which
is now trans­par­ent!</p>
<pre><code class="hljs language-css"><span class="hljs-selector-id">#input</span> {
    <span class="hljs-attribute">color</span>: transparent;
    <span class="hljs-attribute">text-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">#0EFF1F</span>;
}
</code></pre>
<p>Wow!! Nice.</p>
<p>Another big prob­lem was mak­ing scrolling work nicely. This was more dif­fi­cult
than you would ini­tially ex­pect, be­cause the in­put is a <code>contentEditable</code> div,
while the rest of the text is a sep­a­rate div. A cou­ple of <code>overflow</code> rules did
the job nicely, though.</p>
<h4>Procedural Generation</h4>
<p>This is the cool part! My biggest gripe with the old im­ple­men­ta­tion was how much
was hard­coded. I wanted to be able to more or less browse the en­tire site with
the ter­mi­nal, so hard­cod­ing every­thing was not a vi­able op­tion.</p>
<p>This means I needed an <span class="small-caps">API</span> or some­thing to query for all of the dif­fer­ent parts
of the site. Fortunately, I have Jekyll!</p>
<p>Here’s the amaz­ing thing about Jekyll: it can gen­er­ate <strong>any</strong> doc­u­ment. This
includes not just Markdown or <span class="small-caps">HTML</span> files. The trick is to use Jekyll to gen­er­ate
a <span class="small-caps">JSON</span> file with in­for­ma­tion about the web­site.</p>
<blockquote>
<p><code>mind = blown</code></p>
</blockquote>
<p>Here are the en­tire con­tents of <code>terminal.json</code>, which is the rel­e­vant JSON
file:</p>
<pre><code class="hljs language-js">---
---
{% capture nl %}
{% endcapture %}
{% assign files = site.documents %}
{% <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> site.html_pages %}
{% assign files = files | push: page %}
{% endfor %}
{
    {% <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> files %}
    <span class="hljs-string">"{{ page.url }}"</span>: {
        <span class="hljs-string">"content"</span>: <span class="hljs-string">"{{ page.content | replace: '"</span><span class="hljs-string">', "'</span><span class="hljs-string">" | normalize_whitespace}}"</span>
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
}
</code></pre>
<p>That’s all there is to it. This gen­er­ates a <span class="small-caps">JSON</span> ob­ject of all of the pages in
the web­site, with the url as the key and in­clud­ing the con­tent as the sole
prop­erty of each page.</p>
<p>You end up with a <span class="small-caps">JSON</span> file look­ing like <a href="https://naitian.org/terminal.json">this</a>.</p>
<p>Now, this is still not won­der­ful, be­cause all we have now is a bunch of file
paths. This does­n’t en­code in­for­ma­tion about what is and is not in the cur­rent
di­rec­tory.</p>
<p>So I added a <code>pwd</code> vari­able. I now re­al­ize <code>pwd</code> stands for<span class="push-double"></span> <span class="pull-double">“</span>print work­ing
di­rec­tory”, so it does­n’t re­ally make sense to name a vari­able that, but in my
mind, it just means<span class="push-double"></span> <span class="pull-double">“</span>our cur­rent work­ing di­rec­tory”, and <code>ocwd</code> just does­n’t have the same ring to it. I use this to keep track of where in the tree I am at the mo­ment</p>
<p>I then search down the list of files to see which paths are di­rect chil­dren of
the <code>pwd</code>.</p>
<p>Everything else is pretty straight­for­ward: I just in­ject the <code>content</code> of the
se­lected path.</p>
<p>This is what gets me the pro­ce­du­rally gen­er­ated func­tion­al­ity of the ter­mi­nal.
That’s not all I wanted though; I wanted it to be even more dy­namic. I wanted
the ter­mi­nal to be ex­ten­si­ble, so that I would be able to add new com­mands
re­ally eas­ily.</p>
<p>Well then. Let’s get started.</p>
<h4>Extensibility</h4>
<p>I de­cided on us­ing <span class="small-caps">ES6</span> classes to or­ga­nize the JavaScript into a self-con­tained
unit.I’ve ex­per­i­mented with this be­fore to some suc­cess.</p>
<p>The ac­tual im­ple­men­ta­tion was very stright­for­ward. I ba­si­cally have a map of
pos­si­ble com­mands mapped to the func­tions that they call. All of the com­mands
have ac­cess to the in­stance vari­ables. Easy, clean stuff.</p>
<h3>Wrap-up</h3>
<p>So I guess that sums up the tech com­ponenet of the ter­mi­nal easter egg. Even
though it was just an easter egg, it was prob­a­bly one of the things I spent the
most time on, just to get every­thing work­ing okay.</p>
<h4>Improvements</h4>
<p>There are still some im­prove­ments to be made; some (obviously) less triv­ial than
oth­ers.</p>
<ol>
<li>I want tab com­ple­tion.</li>
<li>I want to be able to reg­is­ter new com­mands out­side of the ac­tual class</li>
<li>Lists ex­tend hor­i­zon­tally, not ver­ti­cally.</li>
</ol>
<p>Overall, I’m re­ally happy with how it turned out, though, and I think this is a
great foun­da­tion to keep build­ing on.</p>
</article>

        </div>
    </body>
</html>
